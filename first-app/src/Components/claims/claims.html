<div class="p-8 bg-gray-50 min-h-screen">
  <h1 class="text-3xl font-bold text-blue-800 mb-8">Insurance Claims Processing</h1>

  <section class="bg-white p-6 rounded-lg shadow-md mb-10">
  <h2 class="text-xl font-bold mb-4">File a Claim</h2>
  <div class="grid gap-4">
    <select (change)="onPolicySelect(policySelect.value)" #policySelect class="p-2 border rounded">
      <option value="">-- Select Policy (Auto-fills Details) --</option>
      @for (p of policies; track p.id) {
        <option [value]="p.id">{{ p.name }} ({{ p.id }})</option>
      }
    </select>
    
    <!-- FIXED: Use [ngModel] + (ngModelChange) instead of readonly [value] -->
    <input type="text" 
           [ngModel]="newClaim.type || ''" 
           (ngModelChange)="newClaim.type = $event"
           placeholder="Auto-filled Type" 
           class="p-2 bg-gray-100 border rounded">
    
    <input type="number" [(ngModel)]="newClaim.amount" placeholder="Claim Amount" class="p-2 border rounded">
    <textarea [(ngModel)]="newClaim.description" placeholder="Description" class="p-2 border rounded">
    </textarea>
    
    <button (click)="saveClaim()" class="bg-blue-600 text-white py-2 rounded font-bold">Submit Claim</button>
  </div>
</section>


  <section class="mb-10">
    <h2 class="text-xl font-bold mb-4">My Claim History</h2>
    <div class="bg-white rounded shadow">
      @for (c of claimHistory; track c.id) {
        <div class="p-4 border-b flex justify-between items-center">
          <span>Policy: {{ c.policyId }} - ₹{{ c.amount }}</span>
          <span class="px-3 py-1 rounded-full text-xs font-bold uppercase" 
                [class.bg-yellow-200]="c.status === 'pending'"
                [class.bg-green-200]="c.status === 'approved'">
            {{ c.status }}
          </span>
        </div>
      } @empty {
        <p class="p-4 text-gray-500">No claims filed yet.</p>
      }
    </div>
  </section>

  <section class="border-t-4 border-red-500 pt-8">
    <h2 class="text-xl font-bold mb-4 text-red-700">Admin Review Panel</h2>
    <div class="space-y-4">
      @for (claim of allClaims; track claim.id) {
        @if (claim.status === 'pending') {
          <div class="bg-white p-4 rounded shadow border flex justify-between items-center">
            <div>
              <p class="font-bold">Claim for ₹{{ claim.amount }}</p>
              <p class="text-sm text-gray-600">{{ claim.description }}</p>
            </div>
            <div class="flex gap-2">
              <button (click)="updateStatus(claim.id, 'approved')" class="bg-green-500 text-white px-4 py-1 rounded">Approve</button>
              <button (click)="updateStatus(claim.id, 'rejected')" class="bg-red-500 text-white px-4 py-1 rounded">Reject</button>
            </div>
          </div>
        }
      }
    </div>
  </section>
</div>