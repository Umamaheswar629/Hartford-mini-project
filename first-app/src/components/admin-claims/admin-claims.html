
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
  <div class="mb-8 flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Claims Overview</h1>
      <p class="text-gray-500">View and manage all submitted insurance claims.</p>
    </div>
    <div class="text-xs text-indigo-500 font-medium animate-pulse">
      ● Live Sync Active
    </div>
  </div>

  <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6 flex flex-col md:flex-row gap-4 items-center">
    <div class="flex-1 relative w-full">
      <input type="text" 
             [ngModel]="searchText" 
             (ngModelChange)="onSearch($event)" 
             placeholder="Search by ID, Policy, or Status..."
             class="w-full pl-4 pr-4 py-2.5 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition-all">
    </div>

    <div class="flex items-center gap-2">
      <label class="text-sm font-medium text-gray-500">Sort by:</label>
      <select [ngModel]="sortBy" 
              (ngModelChange)="onSort($event)" 
              class="border border-gray-200 rounded-lg px-4 py-2.5 bg-white text-gray-700 outline-none">
        <option value="date">Date</option>
        <option value="amount">Amount</option>
        <option value="status">Status</option>
      </select>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
    <table class="min-w-full divide-y divide-gray-100">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase">Policy & ID</th>
          <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase">Type & Date</th>
          <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase">Amount</th>
          <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase">Status</th>
          <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase">Assign Agent</th>
          <th class="px-6 py-4 text-right text-xs font-bold text-gray-400 uppercase">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-50">
        @for (c of filteredClaims$ | async; track c.id) {
          <tr class="hover:bg-indigo-50/30 transition-colors group cursor-pointer" (click)="toggleDetails(c.id)">
            <td class="px-6 py-4">
              <div class="font-bold text-gray-900">Pol: {{ c.policyId }}</div>
              <div class="text-xs text-gray-400">Claim: {{ c.id }}</div>
            </td>
            <td class="px-6 py-4">
              <div class="text-sm font-medium text-gray-700">{{ c.type }}</div>
              <div class="text-xs text-gray-400">{{ c.date | date:'mediumDate' }}</div>
            </td>
            <td class="px-6 py-4 font-semibold text-gray-900">₹{{ c.amount | number }}</td>
            <td class="px-6 py-4">
              <span [class]="'px-3 py-1 rounded-full text-xs font-bold capitalize ' + getStatusClass(c.status)">
                {{ c.status }}
              </span>
            </td>
            <td class="px-6 py-4" (click)="$event.stopPropagation()">
              <select [ngModel]="c.assignedAgentId" 
                      (ngModelChange)="assignAgent(c, $event)"
                      class="text-xs border border-gray-200 rounded p-1 outline-none focus:ring-1 focus:ring-indigo-500">
                <option [value]="null">Unassigned</option>
                @for (agent of agents$ | async; track agent.agentId) {
                  <option [value]="agent.agentId">{{ agent.name }}</option>
                }
              </select>
            </td>
            <td class="px-6 py-4 text-right space-x-3">
              <button class="text-indigo-600 hover:text-indigo-900 font-semibold text-sm">View</button>
              <button (click)="deleteClaim(c.id); $event.stopPropagation()" class="text-red-400 hover:text-red-600 font-semibold text-sm">Delete</button>
            </td>
          </tr>

          @if (selectedClaimId === c.id) {
            <tr class="bg-gray-50/50">
              <td colspan="6" class="px-8 py-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <h4 class="text-xs font-bold text-gray-400 uppercase mb-2">Description</h4>
                    <p class="text-sm text-gray-700">{{ c.description }}</p>
                  </div>
                  <div>
                    <h4 class="text-xs font-bold text-gray-400 uppercase mb-2">Admin Remarks</h4>
                    <p class="text-sm text-gray-500 italic">{{ c.remarks || 'No remarks provided.' }}</p>
                  </div>
                </div>
              </td>
            </tr>
          }
        } @empty {
          <tr>
            <td colspan="6" class="p-20 text-center text-gray-400">
              No claims found matching your criteria.
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>